<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kirwan, PD">
<meta name="dcterms.date" content="2025-04-17">
<meta name="description" content="Some theory of multi-state models and their applications in epidemiology, including estimating transition intensities and the time spent in a state.">

<title>Part V: Multi-state models – Peter Kirwan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6aa7beace821ed751f58dfe60cd888a9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-1dcf8f7c4b5e194aeb69a94b63b10692.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-6aa7beace821ed751f58dfe60cd888a9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" href="../font/inter.css">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../style.css">
<meta property="og:title" content="Part V: Multi-state models – Peter Kirwan">
<meta property="og:description" content="Some theory of multi-state models and their applications in epidemiology, including estimating transition intensities and the time spent in a state.">
<meta property="og:image" content="https://www.pkirwan.com/images/multi-state-models-banner.png">
<meta property="og:site_name" content="Peter Kirwan">
<meta property="og:image:height" content="1140">
<meta property="og:image:width" content="2040">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Peter Kirwan</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html#about"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html#blog"> 
<span class="menu-text">Survival data posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html#recent-publications"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html#talks"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../index.html#contact"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Part V: Multi-state models</h1>
                  <div>
        <div class="description">
          Some theory of multi-state models and their applications in epidemiology, including estimating transition intensities and the time spent in a state.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Transition intensity</div>
                <div class="quarto-category">Markov property</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.pkirwan.com">Kirwan, PD</a> <a href="https://orcid.org/0000-0001-6904-0500" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 17, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#multi-state-survival-models" id="toc-multi-state-survival-models" class="nav-link active" data-scroll-target="#multi-state-survival-models">Multi-state survival models</a></li>
  <li><a href="#stochastic-processes" id="toc-stochastic-processes" class="nav-link" data-scroll-target="#stochastic-processes">Stochastic processes underlying multi-state models</a>
  <ul class="collapse">
  <li><a href="#parameter-processes" id="toc-parameter-processes" class="nav-link" data-scroll-target="#parameter-processes">Discrete and continuous parameter processes</a></li>
  <li><a href="#counting-processes" id="toc-counting-processes" class="nav-link" data-scroll-target="#counting-processes">Counting processes</a></li>
  <li><a href="#markov-process" id="toc-markov-process" class="nav-link" data-scroll-target="#markov-process">Markov process</a></li>
  <li><a href="#time-homogeneous-markov-processes" id="toc-time-homogeneous-markov-processes" class="nav-link" data-scroll-target="#time-homogeneous-markov-processes">Time-homogeneous Markov processes</a></li>
  <li><a href="#multi-state-processes" id="toc-multi-state-processes" class="nav-link" data-scroll-target="#multi-state-processes">Multi-state processes</a></li>
  </ul></li>
  <li><a href="#multi-state-models" id="toc-multi-state-models" class="nav-link" data-scroll-target="#multi-state-models">Multi-state models</a></li>
  <li><a href="#continuous-time-msms" id="toc-continuous-time-msms" class="nav-link" data-scroll-target="#continuous-time-msms">Continuous-time multi-state models</a>
  <ul class="collapse">
  <li><a href="#covariates" id="toc-covariates" class="nav-link" data-scroll-target="#covariates">Covariates</a></li>
  <li><a href="#sojourn-time" id="toc-sojourn-time" class="nav-link" data-scroll-target="#sojourn-time">Sojourn time</a></li>
  </ul></li>
  <li><a href="#discrete-time-msms" id="toc-discrete-time-msms" class="nav-link" data-scroll-target="#discrete-time-msms">Discrete-time multi-state models</a></li>
  <li><a href="#semi-hidden" id="toc-semi-hidden" class="nav-link" data-scroll-target="#semi-hidden">Semi-Markov and hidden Markov models</a></li>
  <li><a href="#coming-next" id="toc-coming-next" class="nav-link" data-scroll-target="#coming-next">Coming next</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">






<p>This is part five of a series on statistical methods for analysing time-to-event, or “survival” data.</p>
<section id="multi-state-survival-models" class="level2">
<h2 class="anchored" data-anchor-id="multi-state-survival-models">Multi-state survival models</h2>
<p>When disease processes are more complex, or when intermediate events may influence the final outcome, the <a href="./classical-survival-methods.html">standard survival methods</a> <a href="./competing-risks-methods.html">described so far</a> may be insufficient to explore the effects of treatment on these outcomes. In these cases, multi-state models, which are more flexible and hence better able to investigate the different pathways that patients may experience, can be applied. These models allow for joint estimation of features of the underlying process and the associated hazards of transition for a set of given covariates, and implicitly account for competing risks.</p>
<p>This section provides an introduction to the theory of multi-state processes and describes how these relate to continuous-time and discrete-time multi-state models.</p>
</section>
<section id="stochastic-processes" class="level2">
<h2 class="anchored" data-anchor-id="stochastic-processes">Stochastic processes underlying multi-state models</h2>
<p>Multi-state models combine statistical inference with the theory of stochastic processes.</p>
<section id="parameter-processes" class="level3">
<h3 class="anchored" data-anchor-id="parameter-processes">Discrete and continuous parameter processes</h3>
<p>A stochastic process is formally defined as a collection of random variables <span class="math inline">\(\{X(t),\; t \in T\}\)</span>, indexed by a parameter <span class="math inline">\(t\)</span> which varies in a mathematical index set <span class="math inline">\(T\)</span>. The variable <span class="math inline">\(X(t)\)</span> is the state of the process at time <span class="math inline">\(t\)</span>, and the set <span class="math inline">\(\mathcal{S}\)</span> of all possible values of <span class="math inline">\(X(t)\)</span> is termed the <em>state space</em>.</p>
<p>Two important cases of stochastic processes are discrete parameter processes, when <span class="math inline">\(T = \{\pm1, \pm2, \pm3, \dots\}\)</span>, and continuous parameter processes, when <span class="math inline">\(T = \{t:-\infty &lt; t &lt; \infty\}\)</span>. Both may be restricted to the positive domain, in which case the parameter <span class="math inline">\(t\)</span> may be used to represent time, and these processes are termed ‘discrete-time’ and ‘continuous-time’ processes.</p>
</section>
<section id="counting-processes" class="level3">
<h3 class="anchored" data-anchor-id="counting-processes">Counting processes</h3>
<p>In survival analyses, the focus is typically on observing events as they occur over time, forming a class of stochastic process known as a <em>point process</em>. If the number of events that occur over time are counted, then the stochastic process is instead known as a <em>counting process</em>. Counting processes form the basis for multi-state models, and linkage to the theory of martingales (not discussed here) provides a theoretical framework for these models.</p>
</section>
<section id="markov-process" class="level3">
<h3 class="anchored" data-anchor-id="markov-process">Markov process</h3>
<p>A stochastic process is called a ‘Markov process’ if the future state of a process depends only on the present state, and not on the sequence of events that preceded it. Equivalently, for a Markov process the conditional probability of a future state <span class="math inline">\(X(t_{i+j})\)</span> given <span class="math inline">\(X(t_i)\)</span> is independent of previous states <span class="math inline">\(X(t_0), X(t_1), \dots, X(t_{i-1})\)</span>.</p>
</section>
<section id="time-homogeneous-markov-processes" class="level3">
<h3 class="anchored" data-anchor-id="time-homogeneous-markov-processes">Time-homogeneous Markov processes</h3>
<p>Markov processes are said to be ‘time-homogeneous’ if the probability of transition from one state to the next (termed the <em>transition probability</em>) is independent of the time parameter <span class="math inline">\(t\)</span>. Equivalently, for <span class="math inline">\(\Pr(X(t + u) = s \mid X(t) = r)\)</span> denoting the conditional probability of a process <span class="math inline">\(X(\cdot)\)</span> being in state <span class="math inline">\(s\)</span> at time <span class="math inline">\(t + u\)</span>, given the process was in state <span class="math inline">\(r\)</span> at time <span class="math inline">\(t\)</span>, a Markov process is time-homogeneous if:</p>
<p><span class="math display">\[
\Pr(X(t+u) = s \mid X(t) = r) = \Pr(X(u) = s \mid X(0) = r)
\]</span></p>
<p>A well-known time-homogeneous Markov counting process is the Poisson process, where events occur randomly and independently of each other. A homogeneous Poisson process is described by its constant intensity parameter <span class="math inline">\(\lambda &gt; 0\)</span>, which represents the average rate of events that occur per unit time. For any infinitesimal time interval <span class="math inline">\([t, t+\delta]\)</span>, as <span class="math inline">\(\delta \rightarrow 0\)</span>, the probability of exactly one event occurring in this interval is asymptotically <span class="math inline">\(\lambda\delta\)</span>.</p>
</section>
<section id="multi-state-processes" class="level3">
<h3 class="anchored" data-anchor-id="multi-state-processes">Multi-state processes</h3>
<p>Multi-state processes are discrete-state stochastic processes with a finite state space <span class="math inline">\(\mathcal{S} = \{1, 2, \ldots, m\}\)</span>. In these processes, an individual begins in one state and spends a random, continuously-distributed time in that state before moving to a random next state. Multi-state processes are defined by the initial distribution of the states <span class="math inline">\(\Pr(X(0) = r)\)</span>, and the transition probabilities <span class="math inline">\(\Pr(X(t + u) = s \mid X(t) = r, \mathcal{X}_t)\)</span> from state <span class="math inline">\(r\)</span> to state <span class="math inline">\(s\)</span> during the interval <span class="math inline">\((t, t + u]\)</span>, with <span class="math inline">\(r,s \in \mathcal{S}\)</span>, and where <span class="math inline">\(\mathcal{X}_t\)</span> represents the history of the process <span class="math inline">\(X(\cdot)\)</span> up to time <span class="math inline">\(t\)</span>.</p>
<p><a href="#fig-counting-process" class="quarto-xref">Figure&nbsp;1</a> shows how a counting process may be built on top of a multi-state process: panel A shows a multi-state process with transitions between two states, and the corresponding counting process for the transition event from State 1 <span class="math inline">\(\rightarrow\)</span> State 2 is shown in panel B.</p>
<div id="fig-counting-process" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-counting-process-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multi-state-models_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-counting-process-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Example of transitions between two states in a multi-state process (panel A), and the corresponding counting process for the State 1 → State 2 transition (panel B).
</figcaption>
</figure>
</div>
</section>
</section>
<section id="multi-state-models" class="level2">
<h2 class="anchored" data-anchor-id="multi-state-models">Multi-state models</h2>
<p>In a multi-state model, each state represents a different stage or condition that an individual may experience. The transitions between these states are modelled as a multi-state process, with the time spent in each state and the transitions between states being random variables that can be estimated from data.</p>
<p>Multi-state models are particularly useful in the context of disease progression, as each state in the model can be used to represent a different level of disease severity, with transitions between states representing progression. This may allow for a more nuanced understanding of disease processes, capturing the different pathways that patients may experience.</p>
</section>
<section id="continuous-time-msms" class="level2">
<h2 class="anchored" data-anchor-id="continuous-time-msms">Continuous-time multi-state models</h2>
<div id="fig-msm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-msm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../images/multi-state-model.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-msm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Example of a three-state model with transitions between states according to transition intensities <span class="math inline">\(\{q_{r,s} : r,s \in (1,2,3)\}\)</span>
</figcaption>
</figure>
</div>
<p>Continuous-time multi-state models are defined by transition intensities, <span class="math inline">\(q_{r,s}(t,
\boldsymbol{z}(t))\)</span>, which represent the instantaneous hazard of moving from state <span class="math inline">\(r\)</span> to state <span class="math inline">\(s\)</span> at time <span class="math inline">\(t\)</span>, dependent on a set of explanatory, potentially time-varying, covariates <span class="math inline">\(\boldsymbol{z}(t)\)</span>. Defining an individual’s state at time <span class="math inline">\(t\)</span> as <span class="math inline">\(X(t)\)</span> then:</p>
<p><span class="math display">\[
q_{r,s}(t, \boldsymbol{z}(t)) = \lim_{\delta t\downarrow 0}\frac{\Pr(X(t+\delta t)=s \mid X(t)=r)}{\delta t}
\]</span></p>
<p>From <a href="survival-analysis.html#hazard-function">the definition of the hazard function</a>, this transition intensity is equivalent to the hazard of transition from one state to another. These transition intensities form a <em>transition intensity matrix</em> <span class="math inline">\(\mathbf{Q}\)</span>, whose rows sum to zero, with diagonal entries defined by:</p>
<p><span class="math display">\[q_{r,r}(t, \boldsymbol{z}(t)) = - \sum_{s \neq r} q_{r,s}(t, \boldsymbol{z}(t))\]</span></p>
<p>For the example three-state model shown in <a href="#fig-msm" class="quarto-xref">Figure&nbsp;2</a> this matrix would be:</p>
<p><span class="math display">\[
\mathbf{Q} = \begin{bmatrix}
-q_{1,2}-q_{1,3} &amp; q_{1,2} &amp; q_{1,3} \\
q_{2,1} &amp; -q_{2,1}-q_{2,3} &amp; q_{2,3} \\
0 &amp; 0 &amp; 0 \\
\end{bmatrix}
\]</span></p>
<p>Here, state 3 is known as an ‘absorbing’ state, as individuals do not leave the state after arrival, while states 1 and 2 are `transient’ states. The <em>transition probability matrix</em>, which contains the probabilities of moving between states within a time-interval of length <span class="math inline">\(t\)</span> is derived from the transition intensity matrix by the matrix exponential:</p>
<p><span class="math display">\[\mathbf{P}(t) = \exp(t\mathbf{Q}) = \sum_{n=0}^{\infty}\frac{t^n}{n!}\mathbf{Q}^n\]</span></p>
<section id="covariates" class="level3">
<h3 class="anchored" data-anchor-id="covariates">Covariates</h3>
<p>The (potentially time-varying) effect of a given set of <span class="math inline">\(M\)</span> covariates, <span class="math inline">\(\boldsymbol{z}(t) = \{z_1(t), \ldots, z_M(t)\}\)</span>, on the transition intensities <span class="math inline">\(q_{r,s}(t, \boldsymbol{z}(t))\)</span> can be expressed via a proportional hazards regression model. Typically these combine a parametric baseline hazard, <span class="math inline">\(q^{(0)}_{r,s}(t)\)</span>, with log-linear regression:</p>
<p><span class="math display">\[\begin{align*}
q_{r,s}(t, \boldsymbol{z}(t)) &amp; = q^{(0)}_{r,s}(t)\exp\left(\sum_{m=1}^{M}\beta_{r,s,m}z_{m}(t)\right) \\
&amp; = q^{(0)}_{r,s}(t)\exp\left(\boldsymbol{\beta}_{r,s}^\mathsf{T}\boldsymbol{z}(t)\right)
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\exp(\beta_{r,s,m})\)</span> is the hazard ratio for the <span class="math inline">\(m\)</span>th covariate on the <span class="math inline">\(r \rightarrow s\)</span> transition.</p>
</section>
<section id="sojourn-time" class="level3">
<h3 class="anchored" data-anchor-id="sojourn-time">Sojourn time</h3>
<p>The time spent in a state prior to transition is termed the <em>sojourn time</em>, with its mean given by the inverse of the transition intensity for remaining in the state:</p>
<p><span class="math display">\[E(T_r) = -\frac{1}{q_{r,r}}\]</span></p>
</section>
</section>
<section id="discrete-time-msms" class="level2">
<h2 class="anchored" data-anchor-id="discrete-time-msms">Discrete-time multi-state models</h2>
<p>For population studies which measure duration in discrete time, discrete-time multi-state models may be applied. Since the concept of instantaneous risk does not apply in discrete time, transition probabilities are instead defined which represent the probability of transition from state <span class="math inline">\(r\)</span> to state <span class="math inline">\(s\)</span> in the time interval <span class="math inline">\((t_i,t_j]\)</span>, <span class="math inline">\(t_j&gt;t_i\)</span>:</p>
<p><span class="math display">\[p_{r,s}(t_i, t_j) = \Pr(X(t_j) = s \mid X(t_i) = r)\]</span></p>
</section>
<section id="semi-hidden" class="level2">
<h2 class="anchored" data-anchor-id="semi-hidden">Semi-Markov and hidden Markov models</h2>
<p>Multi-state models are typically specified to be Markov, i.e.&nbsp;<span class="math inline">\(q_{r,s}(t; \mathcal{X}_t) = q_{r,s}(t)\)</span>, where <span class="math inline">\(\mathcal{X}_t\)</span> is the observation history of the process up to time <span class="math inline">\(t\)</span>. Semi-Markov models relax the Markov assumption, allowing dependence on the time of entry into the current state, i.e.&nbsp;<span class="math inline">\(q_{r,s}(t;\mathcal{X}_t)=q_{r,s}(t-t_r)\)</span>, where <span class="math inline">\(t_r\)</span> is the time of entry into the current state <span class="math inline">\(r\)</span>.</p>
<p>Hidden Markov models may also be specified to allow for unobserved, or ‘latent’, states to be included in the model. These can be particularly useful for modelling complex disease processes, where progression of the disease is influenced by unobserved factors and the time to event depends on the current state of the disease (for instance in models of HIV progression); as well as when the disease state is imperfectly observed (for instance to incorporate measurement error).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Key takeaways
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Multi-state models extend standard survival methods by allowing individuals to move between multiple states over time, not just from “alive” to “dead”</li>
<li>These models are built on stochastic processes theory, particularly Markov processes, where future states depend only on the present state</li>
<li>Transition intensities (analogous to hazard rates) describe the instantaneous risk of moving from one state to another</li>
<li>Multi-state models can incorporate covariates to identify factors that influence transition rates between states</li>
<li>Different model variations (time-homogeneous, semi-Markov, hidden Markov) provide flexibility to model complex disease processes with various assumptions</li>
</ul>
</div>
</div>
</section>
<section id="coming-next" class="level2">
<h2 class="anchored" data-anchor-id="coming-next">Coming next</h2>
<p>In the next post, I’ll discuss statistical inference methods for multi-state models, including non-parametric estimation with the Aalen-Johansen estimator and parametric approaches using maximum likelihood.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Aalen O, Borgan O, Gjessing H. <a href="https://play.google.com/store/books/details?id=2toprArSUMAC">Survival and Event History Analysis: A Process Point of View</a>. <em>Springer</em>; 2008. 540 p.</li>
<li>Andersen PK, Borgan O, Gill RD, Keiding N. <a href="http://dx.doi.org/10.1007/978-1-4612-4348-9">Statistical models based on counting processes</a>. <em>Springer</em>; 1996. 784 p.</li>
<li>Andersen PK, Keiding N. <a href="http://dx.doi.org/10.1191/0962280202SM276ra">Multi-state models for event history analysis</a>. <em>Stat Methods Med Res</em>. 2002;11(2):91-115.</li>
<li>Chiang CL. An introduction to stochastic processes and their applications. <em>RE Krieger</em>; 1980.</li>
<li>Putter H, Fiocco M, Geskus RB. <a href="http://dx.doi.org/10.1002/sim.2712">Tutorial in biostatistics: competing risks and multi-state models</a>. <em>Stat Med</em>. 2007;26(11):2389-430.</li>
<li>van den Hout A. <a href="https://doi.org/10.1201/9781315374321">Multi-State Survival Models for Interval-Censored Data</a>. <em>CRC Press</em>; 2016. 238 p.</li>
</ul>
<div class="post-navigation">
<p><a href="../blog/competing-risks-methods.html">← Previous post</a></p>
<p><a href="../blog/statistical-inference-msms.html">Next post →</a></p>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{pd2025,
  author = {PD , Kirwan},
  title = {Part {V:} {Multi-state} Models},
  date = {2025-04-17},
  url = {https://www.pkirwan.com/blog/multi-state-models.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-pd2025" class="csl-entry quarto-appendix-citeas" role="listitem">
PD, Kirwan. 2025. <span>“Part V: Multi-State Models.”</span> April 17,
2025. <a href="https://www.pkirwan.com/blog/multi-state-models.html">https://www.pkirwan.com/blog/multi-state-models.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.pkirwan\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.pkirwan.com">
<p>www.pkirwan.com</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>